Query #1:
---------
	
SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.pkts`) as packet_count by span(`aws.networkfirewall.event.timestamp`, 2d) as timestamp_span, `aws.networkfirewall.event.src_ip` | rename `aws.networkfirewall.event.src_ip` as `Source IP` | sort - packet_count | head 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"source_ips": {
"terms": {
"field": "aws.networkfirewall.event.src_ip",
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #2:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.bytes`) as sum_bytes by span(`aws.networkfirewall.event.timestamp`, 2d) as timestamp_span, `aws.networkfirewall.event.src_ip` | rename  `aws.networkfirewall.event.src_ip` as `Source IP` | sort - sum_bytes | head 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"source_ips": {
"terms": {
"field": "aws.networkfirewall.event.src_ip",
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #3:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.pkts`) as packet_count by span(`aws.networkfirewall.event.timestamp`, 2d) as timestamp_span, `aws.networkfirewall.event.dest_ip` | rename `aws.networkfirewall.event.dest_ip` as `Destination IP` | sort - packet_count | head 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"source_ips": {
"terms": {
"field": "aws.networkfirewall.event.dest_ip",
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #4:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.bytes`) as bytes by span(`aws.networkfirewall.event.timestamp`, 2d) as timestamp_span, `aws.networkfirewall.event.dest_ip` | rename `aws.networkfirewall.event.dest_ip` as `Destination IP` | sort - bytes | head 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"source_ips": {
"terms": {
"field": "aws.networkfirewall.event.dest_ip",
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #5:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS SUM(`aws.networkfirewall.event.netflow.pkts`) as Packets, SUM(`aws.networkfirewall.event.netflow.bytes`) as Bytes by `aws.networkfirewall.event.src_ip` | RENAME `aws.networkfirewall.event.src_ip` as `Source IP` | SORT - Bytes, Packets | HEAD 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.src_ip",
"order": {
"2": "desc"
},
"size": 10
},
"aggs": {
"1": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"2": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #6:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS SUM(`aws.networkfirewall.event.netflow.pkts`) as Packets, SUM(`aws.networkfirewall.event.netflow.bytes`) as Bytes by `aws.networkfirewall.event.dest_ip` | RENAME `aws.networkfirewall.event.dest_ip` as `Destination IP`  | SORT - Bytes, Packets | HEAD 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.dest_ip",
"order": {
"2": "desc"
},
"size": 10
},
"aggs": {
"1": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"2": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #7:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.pkts`) as packet_count by span(`aws.networkfirewall.event.timestamp`, 2d) as timestamp_span, `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip` | eval `Src IP - Dst IP` = concat(`aws.networkfirewall.event.src_ip`, "-", `aws.networkfirewall.event.dest_ip`) | sort - packet_count | head 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
}
],
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #8:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats sum(`aws.networkfirewall.event.netflow.bytes`) as bytes by span(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip` | eval `Src IP - Dst IP` = concat(`aws.networkfirewall.event.src_ip`, "-", `aws.networkfirewall.event.dest_ip`) | sort - bytes | head 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
}
],
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #9:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where `aws.networkfirewall.event.alert.action` = "allowed" | stats count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d) as time_bucket, `aws.networkfirewall.event.http.hostname` | rename `aws.networkfirewall.event.http.hostname` as `Hostname` | sort - event_count

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.hostname",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"actions": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"size": 5
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
}
}
}
}
},
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #10:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where `aws.networkfirewall.event.alert.action` = "blocked" and isnotnull(`aws.networkfirewall.event.http.hostname`) | stats count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d) as time_bucket, `aws.networkfirewall.event.http.hostname` | rename `aws.networkfirewall.event.http.hostname` as `Hostname` | sort - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.hostname",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"actions": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"size": 5
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
}
}
}
}
},
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #11:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where `aws.networkfirewall.event.alert.action` = "allowed" | stats count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d) as time_bucket, `aws.networkfirewall.event.tls.sni` | rename `aws.networkfirewall.event.tls.sni` as `Hostname` | sort - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.tls.sni",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"actions": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"size": 5
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
}
}
}
}
},
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #12:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where `aws.networkfirewall.event.alert.action` = "blocked" and isnotnull(`aws.networkfirewall.event.tls.sni`) | stats count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d) as time_bucket, `aws.networkfirewall.event.tls.sni` | rename `aws.networkfirewall.event.tls.sni` as `Hostname` | sort - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.tls.sni",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"actions": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"size": 5
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
}
}
}
}
},
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.tls.sni"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #13:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE isnotnull(`aws.networkfirewall.event.http.url`) | STATS count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.http.url` | RENAME `aws.networkfirewall.event.http.url` as `URL` | SORT - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.url",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.url"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.url"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #14:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE isnotnull(`aws.networkfirewall.event.http.http_user_agent`) | STATS count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.http.http_user_agent` | RENAME `aws.networkfirewall.event.http.http_user_agent` as `URL` | SORT - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.http_user_agent",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.http_user_agent"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.http_user_agent"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #15:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where (`aws.networkfirewall.event.tls.sni` like "s3%") or (`aws.networkfirewall.event.http.hostname` like "s3%") or (`aws.networkfirewall.event.tls.sni` like "dynamodb%") or (`aws.networkfirewall.event.http.hostname` like "dynamodb%") or (`aws.networkfirewall.event.tls.sni` like "backup%") or (`aws.networkfirewall.event.http.hostname` like "backup%") | STATS count() as Count by `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.app_proto`, `aws.networkfirewall.event.tls.sni`, `aws.networkfirewall.event.http.hostname` | rename `aws.networkfirewall.event.tls.sni` as SNI, `aws.networkfirewall.event.dest_ip` as Dest_IP , `aws.networkfirewall.event.src_ip` as Source_IP, `aws.networkfirewall.event.http.hostname` as Hostname, `aws.networkfirewall.event.app_proto` as App_Proto | SORT - Count

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.src_ip",
"order": {
"_count": "desc"
},
"size": 10
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.dest_ip",
"order": {
"_count": "desc"
},
"size": 5
},
"aggs": {
"4": {
"terms": {
"field": "aws.networkfirewall.event.app_proto",
"order": {
"_count": "desc"
},
"size": 5
},
"aggs": {
"5": {
"terms": {
"field": "aws.networkfirewall.event.tls.sni",
"order": {
"_count": "desc"
},
"size": 5
},
"aggs": {
"6": {
"terms": {
"field": "aws.networkfirewall.event.http.hostname",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 5
}
}
}
}
}
}
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
},
{
"bool": {
"should": [
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"aws.networkfirewall.event.tls.sni"
],
"query": "s\\3*"
}
}
],
"minimum_should_match": 1
}
},
{
"bool": {
"should": [
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"aws.networkfirewall.event.http.hostname"
],
"query": "s\\3*"
}
}
],
"minimum_should_match": 1
}
},
{
"bool": {
"should": [
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"aws.networkfirewall.event.tls.sni"
],
"query": "dynamodb*"
}
}
],
"minimum_should_match": 1
}
},
{
"bool": {
"should": [
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"networkfirewall.event.http.hostname"
],
"query": "dynamodb*"
}
}
],
"minimum_should_match": 1
}
},
{
"bool": {
"should": [
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"aws.networkfirewall.event.tls.sni"
],
"query": "backup*"
}
}
],
"minimum_should_match": 1
}
},
{
"bool": {
"should": [
{
"query_string": {
"fields": [
"aws.networkfirewall.event.http.hostname"
],
"query": "backup*"
}
}
],
"minimum_should_match": 1
}
}
],
"minimum_should_match": 1
}
}
],
"minimum_should_match": 1
}
}
],
"minimum_should_match": 1
}
}
],
"minimum_should_match": 1
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}

Query #16:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS count() as Count by `aws.networkfirewall.event.proto` | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.proto",
"order": {
"_count": "desc"
},
"size": 10
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #17:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE isnotnull(`aws.networkfirewall.event.app_proto`) | STATS count() as Count by `aws.networkfirewall.event.app_proto` | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.app_proto",
"order": {
"_count": "desc"
},
"size": 10
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #18:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_port` | eval `Source Port` = CAST(`aws.networkfirewall.event.src_port` AS STRING) | sort - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ports": {
"terms": {
"field": "aws.networkfirewall.event.src_port",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.src_port"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.src_port"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #19:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | stats count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.dest_port` | eval `Destination Port` = CAST(`aws.networkfirewall.event.dest_port` AS STRING) | sort - Count | HEAD 10\

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ports": {
"terms": {
"field": "aws.networkfirewall.event.dest_port",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.dest_port"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "24h"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.dest_port"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #20:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "TCP" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #21:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "TCP" | STATS sum(aws.networkfirewall.event.netflow.pkts) as Packets by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Packets | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #22:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "TCP" | STATS sum(aws.networkfirewall.event.netflow.bytes) as Bytes by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Bytes | HEAD 10	

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #23:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS count() as Count by `aws.networkfirewall.event.tcp.tcp_flags` | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.tcp.tcp_flags",
"order": {
"_count": "desc"
},
"size": 10
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #24:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "UDP" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #25:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "UDP" | STATS sum(`aws.networkfirewall.event.netflow.pkts`) as Packets by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Packets | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #26:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "UDP" | STATS sum(`aws.networkfirewall.event.netflow.bytes`) as Bytes by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Bytes | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #27:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "ICMP" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 1d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #28:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE aws.networkfirewall.event.alert.action= "blocked" | STATS count() as Count by `aws.networkfirewall.event.alert.signature_id`, `aws.networkfirewall.event.alert.action`, `aws.networkfirewall.event.alert.signature`, `aws.networkfirewall.event.proto` | RENAME  `aws.networkfirewall.event.alert.signature_id` as SID, `aws.networkfirewall.event.alert.action` as Action, `aws.networkfirewall.event.alert.signature` as Message, `aws.networkfirewall.event.proto` as Proto | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature_id",
"order": {
"_count": "desc"
},
"size": 10
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"4": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"5": {
"terms": {
"field": "aws.networkfirewall.event.proto",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
}
}
}
}
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
},
{
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}

Query #29:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview| where `aws.networkfirewall.event.alert.action` = "allowed" | stats count() as Count by `aws.networkfirewall.event.alert.signature_id`, `aws.networkfirewall.event.alert.action`, `aws.networkfirewall.event.alert.signature`, `aws.networkfirewall.event.proto` | rename `aws.networkfirewall.event.alert.signature_id` as SID, `aws.networkfirewall.event.alert.action` as Action, `aws.networkfirewall.event.alert.signature` as Message, `aws.networkfirewall.event.proto` as Proto | sort - Count | head 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature_id",
"order": {
"_count": "desc"
},
"size": 10
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"4": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"5": {
"terms": {
"field": "aws.networkfirewall.event.proto",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
}
}
}
}
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
},
{
"bool": {
"must_not": {
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
}
}
],
"should": [],
"must_not": []
}
}
}

Query #30:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.alert.action` = "blocked"| STATS COUNT() as Count by `aws.networkfirewall.event.src_ip`| SORT - Count| HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"filters": {
"filters": {
"aws.networkfirewall.event.alert.action: blocked": {
"bool": {
"must": [],
"filter": [
{
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.src_ip",
"order": {
"_count": "desc"
},
"size": 10
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #31:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.alert.action` = "blocked" | STATS COUNT() as Count by `aws.networkfirewall.event.dest_ip`| SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"filters": {
"filters": {
"aws.networkfirewall.event.alert.action: blocked": {
"bool": {
"must": [],
"filter": [
{
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.dest_ip",
"order": {
"_count": "desc"
},
"size": 10
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #32:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.alert.action` = "blocked" | STATS COUNT() as `Count` by `aws.networkfirewall.event.dest_port` | EVAL `Destination Port` = CAST(`aws.networkfirewall.event.dest_port` as STRING) | SORT - `Count` | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"filters": {
"filters": {
"aws.networkfirewall.event.alert.action: blocked": {
"bool": {
"must": [],
"filter": [
{
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.dest_port",
"order": {
"_count": "desc"
},
"size": 10
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #33:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.alert.action` = "blocked" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"term": {
"aws.networkfirewall.event.alert.action": "blocked"
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #34:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.alert.action` = 'blocked' and `aws.networkfirewall.event.proto` = 'TCP' | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port`| EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"term": {
"aws.networkfirewall.event.alert.action": "blocked"
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #35:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview| WHERE `aws.networkfirewall.event.alert.action` = 'blocked' and `aws.networkfirewall.event.proto` = 'UDP' | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"term": {
"aws.networkfirewall.event.alert.action": "blocked"
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #36:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = 'TCP' and `aws.networkfirewall.event.netflow.age` > 350 | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.src_port`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP:Port - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, ": ", CAST(`aws.networkfirewall.event.src_port` AS STRING), " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"range": {
"aws.networkfirewall.event.netflow.age": {
"gt": 350
}
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.src_port"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #37:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = 'TCP' and `aws.networkfirewall.event.tcp.syn` = "true" and `aws.networkfirewall.event.tcp.ack` = "true" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.src_port`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port`| EVAL `Src IP:Port - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, ": ", CAST(`aws.networkfirewall.event.src_port` AS STRING), " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"bool": {
"must_not": [
{
"term": {
"aws.networkfirewall.event.tcp.syn": true
}
},
{
"term": {
"aws.networkfirewall.event.tcp.ack": true
}
}
]
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.src_port"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}