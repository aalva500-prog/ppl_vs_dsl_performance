Query #9:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | where `aws.networkfirewall.event.alert.action` = "allowed" | stats count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d) as time_bucket, `aws.networkfirewall.event.http.hostname` | rename `aws.networkfirewall.event.http.hostname` as `Hostname` | sort - event_count

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.hostname",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "2d"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.hostname"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"term": {
"aws.networkfirewall.event.alert.action": "allowed"
}
}
],
"should": [],
"must_not": []
}
}
}

Query #13:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE isnotnull(`aws.networkfirewall.event.http.url`) | STATS count() as event_count by span(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.http.url` | RENAME `aws.networkfirewall.event.http.url` as `URL` | SORT - event_count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"hostnames": {
"terms": {
"field": "aws.networkfirewall.event.http.url",
"size": 10,
"order": {
"total_events": "desc"
}
},
"aggs": {
"total_events": {
"value_count": {
"field": "aws.networkfirewall.event.http.url"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "2d"
},
"aggs": {
"event_count": {
"value_count": {
"field": "aws.networkfirewall.event.http.url"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"exists": {
"field": "aws.networkfirewall.event.http.url"
}
}
],
"should": [],
"must_not": []
}
}
}

Query #16:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS count() as Count by `aws.networkfirewall.event.proto` | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.proto",
"order": {
"_count": "desc"
},
"size": 10
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #20:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "TCP" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "2d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"term": {
"aws.networkfirewall.event.proto": "TCP"
}
}
],
"should": [],
"must_not": []
}
}
}

Query #21:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "TCP" | STATS sum(aws.networkfirewall.event.netflow.pkts) as Packets by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Packets | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_packets": "desc"
}
},
"aggs": {
"total_packets": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"packet_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.pkts"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"term": {
"aws.networkfirewall.event.proto": "TCP"
}
}
],
"should": [],
"must_not": []
}
}
}

Query #23:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | STATS count() as Count by `aws.networkfirewall.event.tcp.tcp_flags` | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.tcp.tcp_flags",
"order": {
"_count": "desc"
},
"size": 10
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #24:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "UDP" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "2d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"term": {
"aws.networkfirewall.event.proto": "UDP"
}
}
],
"should": [],
"must_not": []
}
}
}

Query #26:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = "UDP" | STATS sum(`aws.networkfirewall.event.netflow.bytes`) as Bytes by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port` | EVAL `Src IP - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Bytes | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"total_bytes": "desc"
}
},
"aggs": {
"total_bytes": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
},
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
},
"aggs": {
"byte_count": {
"sum": {
"field": "aws.networkfirewall.event.netflow.bytes"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
},
{
"term": {
"aws.networkfirewall.event.proto": "UDP"
}
}
],
"should": [],
"must_not": []
}
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "1d"
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}

Query #28:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE aws.networkfirewall.event.alert.action= "blocked" | STATS count() as Count by `aws.networkfirewall.event.alert.signature_id`, `aws.networkfirewall.event.alert.action`, `aws.networkfirewall.event.alert.signature`, `aws.networkfirewall.event.proto` | RENAME  `aws.networkfirewall.event.alert.signature_id` as SID, `aws.networkfirewall.event.alert.action` as Action, `aws.networkfirewall.event.alert.signature` as Message, `aws.networkfirewall.event.proto` as Proto | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"aggs": {
"2": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature_id",
"order": {
"_count": "desc"
},
"size": 10
},
"aggs": {
"3": {
"terms": {
"field": "aws.networkfirewall.event.alert.action",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"4": {
"terms": {
"field": "aws.networkfirewall.event.alert.signature",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
},
"aggs": {
"5": {
"terms": {
"field": "aws.networkfirewall.event.proto",
"order": {
"_count": "desc"
},
"missing": "__missing__",
"size": 10
}
}
}
}
}
}
}
}
},
"size": 0,
"stored_fields": [
"*"
],
"script_fields": {},
"docvalue_fields": [
{
"field": "aws.networkfirewall.event.netflow.end",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.netflow.start",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.timestamp",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notafter",
"format": "date_time"
},
{
"field": "aws.networkfirewall.event.tls.notbefore",
"format": "date_time"
}
],
"_source": {
"excludes": []
},
"query": {
"bool": {
"must": [],
"filter": [
{
"match_all": {}
},
{
"bool": {
"should": [
{
"match": {
"aws.networkfirewall.event.alert.action": "blocked"
}
}
],
"minimum_should_match": 1
}
}
],
"should": [],
"must_not": []
}
}
}

Query #37:
---------

SOURCE = flint_new_data_source_default_amazon_networkfirewall__mview | WHERE `aws.networkfirewall.event.proto` = 'TCP' and `aws.networkfirewall.event.tcp.syn` = "true" and `aws.networkfirewall.event.tcp.ack` = "true" | STATS count() as Count by SPAN(`aws.networkfirewall.event.timestamp`, 2d), `aws.networkfirewall.event.src_ip`, `aws.networkfirewall.event.src_port`, `aws.networkfirewall.event.dest_ip`, `aws.networkfirewall.event.dest_port`| EVAL `Src IP:Port - Dst IP:Port` = CONCAT(`aws.networkfirewall.event.src_ip`, ": ", CAST(`aws.networkfirewall.event.src_port` AS STRING), " - ", `aws.networkfirewall.event.dest_ip`, ": ", CAST(`aws.networkfirewall.event.dest_port` AS STRING)) | SORT - Count | HEAD 10

POST flint_new_data_source_default_amazon_networkfirewall__mview/_search
{
"track_total_hits": true,
"size": 0,
"aggs": {
"filtered_actions": {
"filter": {
"bool": {
"filter": [
{
"term": {
"aws.networkfirewall.event.proto": "TCP"
}
},
{
"term": {
"aws.networkfirewall.event.tcp.syn": true
}
},
{
"term": {
"aws.networkfirewall.event.tcp.ack": true
}
}
]
}
},
"aggs": {
"ip_pairs": {
"multi_terms": {
"terms": [
{
"field": "aws.networkfirewall.event.src_ip"
},
{
"field": "aws.networkfirewall.event.src_port"
},
{
"field": "aws.networkfirewall.event.dest_ip"
},
{
"field": "aws.networkfirewall.event.dest_port"
},
{
"field": "aws.networkfirewall.event.proto"
}
],
"size": 10,
"order": {
"_count": "desc"
}
},
"aggs": {
"time_series": {
"date_histogram": {
"field": "aws.networkfirewall.event.timestamp",
"fixed_interval": "2d"
}
}
}
}
}
}
},
"query": {
"bool": {
"filter": [
{
"match_all": {}
}
],
"should": [],
"must_not": []
}
}
}